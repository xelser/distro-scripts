# update $PATH
export PATH=$PATH:/var/lib/flatpak/exports/bin:$HOME/.local/share/flatpak/exports/bin:$HOME/.local/bin

# get distro
export distro_id="$(grep '^ID=' /etc/os-release | cut -d'=' -f2 | cut -d'"' -f2)"

# source .profile if it exists
if [ -f "$HOME/.profile" ]; then
	. "$HOME/.profile"
fi

# autostart in tty
if [ "$(tty)" = "/dev/tty1" ]; then
  # Detect Secure Boot and NVIDIA driver state
  if mokutil --sb-state 2>/dev/null | grep -q "SecureBoot enabled"; then
    # Secure Boot is ON
    if nvidia-smi &>/dev/null; then
      startx                     # Use i3
    else
      startw || startx            # Fallback to swayfx, then i3
    fi
  else
    # Secure Boot is OFF
    startx                         # Always use i3
  fi
fi
