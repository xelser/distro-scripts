#!/bin/bash

# Deps: i3-msg + jq + scrot + notify-send + xclip

# Get focused output (monitor) from i3
focused_output=$(i3-msg -t get_workspaces | jq -r '.[] | select(.focused==true).output')

# Get monitor list in order
mapfile -t outputs < <(xrandr --listmonitors | tail -n +2 | awk '{print $NF}')

# Find index of focused monitor
for i in "${!outputs[@]}"; do
  if [[ "${outputs[$i]}" == "$focused_output" ]]; then
    filename="$HOME/Pictures/scrot_$(date +%F_%T).png"
    scrot -M "$i" "$filename" \
      && xclip -selection clipboard -t image/png -i "$filename" \
      && notify-send -i "$filename" -u low "Screenshot via scrot" "Saved and copied to clipboard" \
      || notify-send -u low "Screenshot aborted"
    exit
  fi
done
